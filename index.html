<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Check-In/Out System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div id="app"></div>

    <script>
        // State management
        let state = {
            telegramBotToken: localStorage.getItem('botToken') || '',
            telegramChatId: localStorage.getItem('chatId') || '',
            showScanner: false,
            formData: { name: '', role: '' },
            submitted: false
        };

        // Check URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('mode') === 'scan') {
            state.showScanner = true;
        }

        function setState(newState) {
            state = { ...state, ...newState };
            render();
        }

        function generateQRCodeURL() {
            const baseUrl = window.location.href.split('?')[0];
            const scanUrl = baseUrl + '?mode=scan';
            return `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(scanUrl)}`;
        }

        function downloadQR() {
            const link = document.createElement('a');
            link.href = generateQRCodeURL();
            link.download = 'Staff_CheckIn_QR.png';
            link.click();
        }

        function saveTelegramConfig() {
            localStorage.setItem('botToken', state.telegramBotToken);
            localStorage.setItem('chatId', state.telegramChatId);
        }

        async function sendToTelegram(action) {
            if (!state.formData.name || !state.formData.role) {
                alert('Please enter your name and role / ·ûü·ûº·ûò·ûî·üÜ·ûñ·üÅ·ûâ·ûà·üí·ûò·üÑ·üá ·ûì·û∑·ûÑ·ûè·ûΩ·ûì·û∂·ûë·û∏');
                return;
            }

            if (!state.telegramBotToken || !state.telegramChatId) {
                alert('Telegram configuration missing / ·ûñ·ûª·üÜ·ûî·û∂·ûì·ûÄ·üÜ·ûé·ûè·üã Telegram');
                return;
            }

            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit', 
                hour12: false 
            });
            const date = now.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            const actionEmoji = action === 'in' ? 'üü¢' : 'üî¥';
            const actionText = action === 'in' ? 'CHECK IN / ·ûÖ·ûº·ûõ' : 'CHECK OUT / ·ûÖ·üÅ·ûâ';
            
            const message = `${actionEmoji} *${actionText}*\n\n` +
                           `üë§ *Name:* ${state.formData.name}\n` +
                           `üíº *Role:* ${state.formData.role}\n` +
                           `üïê *Time:* ${time}\n` +
                           `üìÖ *Date:* ${date}`;

            try {
                const response = await fetch(`https://api.telegram.org/bot${state.telegramBotToken}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: state.telegramChatId,
                        text: message,
                        parse_mode: 'Markdown'
                    })
                });

                if (response.ok) {
                    setState({ submitted: true });
                    setTimeout(() => {
                        setState({ 
                            submitted: false, 
                            formData: { name: '', role: '' } 
                        });
                    }, 3000);
                } else {
                    alert('Failed to send to Telegram / ·ûî·ûö·û∂·ûá·üê·ûô·ûÄ·üí·ûì·ûª·ûÑ·ûÄ·û∂·ûö·ûï·üí·ûâ·ûæ·ûë·üÖ Telegram');
                }
            } catch (error) {
                alert('Error sending to Telegram / ·ûò·û∂·ûì·ûî·ûâ·üí·û†·û∂·ûÄ·üí·ûì·ûª·ûÑ·ûÄ·û∂·ûö·ûï·üí·ûâ·ûæ·ûë·üÖ Telegram');
            }
        }

        function renderAdminView() {
            return `
                <div class="max-w-4xl mx-auto p-6">
                    <div class="text-center mb-8">
                        <div class="flex items-center justify-center gap-3 mb-4">
                            <svg class="w-12 h-12 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path>
                            </svg>
                            <h1 class="text-4xl font-bold text-gray-800">Staff Check-In QR System</h1>
                        </div>
                        <p class="text-gray-600">Configure Telegram and generate QR code for staff check-in/out</p>
                    </div>

                    <div class="bg-white rounded-lg shadow-lg p-8 mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6">Telegram Configuration</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Telegram Bot Token
                                </label>
                                <input
                                    type="text"
                                    id="botToken"
                                    value="${state.telegramBotToken}"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"
                                    onchange="setState({ telegramBotToken: this.value }); saveTelegramConfig();"
                                />
                                <p class="text-xs text-gray-500 mt-1">Get from @BotFather on Telegram</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Telegram Chat ID
                                </label>
                                <input
                                    type="text"
                                    id="chatId"
                                    value="${state.telegramChatId}"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                    placeholder="-1001234567890"
                                    onchange="setState({ telegramChatId: this.value }); saveTelegramConfig();"
                                />
                                <p class="text-xs text-gray-500 mt-1">Get from @userinfobot or @RawDataBot</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-lg p-8 text-center">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6">QR Code for Staff</h2>
                        <div class="bg-gray-50 p-6 rounded-lg inline-block mb-6">
                            <img
                                src="${generateQRCodeURL()}"
                                alt="Check-In QR Code"
                                class="mx-auto border-4 border-indigo-600 rounded-lg"
                            />
                        </div>
                        <p class="text-gray-600 mb-6">Staff scan this QR code to check in/out</p>
                        <button
                            onclick="downloadQR()"
                            class="inline-flex items-center gap-2 bg-green-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors"
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                            </svg>
                            Download QR Code
                        </button>
                        <button
                            onclick="setState({ showScanner: true })"
                            class="block mt-4 mx-auto text-indigo-600 hover:text-indigo-800 text-sm font-medium"
                        >
                            Test Scanner View
                        </button>
                    </div>

                    <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-6 mt-6">
                        <h3 class="font-semibold text-blue-900 mb-3">Setup Instructions:</h3>
                        <ol class="list-decimal list-inside space-y-2 text-blue-800 text-sm">
                            <li>Create a Telegram bot using @BotFather and get the Bot Token</li>
                            <li>Add your bot to a group or get your personal Chat ID</li>
                            <li>Enter the Bot Token and Chat ID above</li>
                            <li>Download the QR code and display it at your entrance</li>
                            <li>Staff scan the QR code to check in/out</li>
                        </ol>
                    </div>
                </div>
            `;
        }

        function renderScannerView() {
            if (state.submitted) {
                return `
                    <div class="min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 flex items-center justify-center p-6">
                        <div class="bg-white rounded-lg shadow-2xl p-8 text-center max-w-md">
                            <svg class="w-24 h-24 text-green-500 mx-auto mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <h2 class="text-3xl font-bold text-gray-800 mb-3">Success!</h2>
                            <p class="text-gray-600 text-lg">Your attendance has been recorded</p>
                            <p class="text-gray-500 mt-2">·ûÄ·ûè·üã·ûè·üí·ûö·û∂·ûú·ûè·üí·ûè·ûò·û∂·ûì·ûö·ûΩ·ûÖ·ûö·û∂·ûõ·üã</p>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="max-w-2xl mx-auto p-6">
                    <div class="text-center mb-8">
                        <svg class="w-16 h-16 text-indigo-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h1 class="text-4xl font-bold text-gray-800 mb-2">Staff Check-In/Out</h1>
                        <p class="text-gray-600 text-lg">·ûÖ·ûº·ûõ-·ûÖ·üÅ·ûâ·ûî·ûª·ûÇ·üí·ûÇ·ûõ·û∑·ûÄ</p>
                    </div>

                    <div class="bg-white rounded-lg shadow-lg p-8">
                        <div class="space-y-6">
                            <div>
                                <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                    Full Name / ·ûà·üí·ûò·üÑ·üá·ûñ·üÅ·ûâ *
                                </label>
                                <input
                                    type="text"
                                    id="staffName"
                                    value="${state.formData.name}"
                                    class="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                    placeholder="·ûü·ûª·ûÅ ·ûü·üÜ·ûé·û∂·ûÑ / John Doe"
                                    onchange="setState({ formData: { ...state.formData, name: this.value } })"
                                />
                            </div>

                            <div>
                                <label class="flex items-center gap-2 text-sm font-medium text-gray-700 mb-2">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                    Role / ·ûè·ûΩ·ûì·û∂·ûë·û∏ *
                                </label>
                                <input
                                    type="text"
                                    id="staffRole"
                                    value="${state.formData.role}"
                                    class="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                    placeholder="·û¢·üí·ûì·ûÄ·ûÇ·üí·ûö·ûî·üã·ûÇ·üí·ûö·ûÑ / Manager"
                                    onchange="setState({ formData: { ...state.formData, role: this.value } })"
                                />
                            </div>

                            <div class="grid grid-cols-2 gap-4 pt-4">
                                <button
                                    onclick="sendToTelegram('in')"
                                    class="flex flex-col items-center justify-center gap-2 bg-green-600 text-white py-4 rounded-lg font-semibold text-lg hover:bg-green-700 transition-colors"
                                >
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    <span>CHECK IN<br/>·ûÖ·ûº·ûõ</span>
                                </button>
                                <button
                                    onclick="sendToTelegram('out')"
                                    class="flex flex-col items-center justify-center gap-2 bg-red-600 text-white py-4 rounded-lg font-semibold text-lg hover:bg-red-700 transition-colors"
                                >
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                    </svg>
                                    <span>CHECK OUT<br/>·ûÖ·üÅ·ûâ</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <button
                        onclick="setState({ showScanner: false }); window.history.pushState({}, '', window.location.pathname);"
                        class="mt-6 text-center w-full text-indigo-600 hover:text-indigo-800 text-sm font-medium"
                    >
                        ‚Üê Back to Admin Panel
                    </button>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            if (state.showScanner) {
                app.innerHTML = renderScannerView();
            } else {
                app.innerHTML = renderAdminView();
            }
        }

        // Initial render
        render();
    </script>
</body>
</html>
