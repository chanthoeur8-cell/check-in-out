<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Check-In/Out System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div id="app"></div>

    <script>
        let state = {
            telegramBotToken: localStorage.getItem('8146471538:AAFXcPD4EiNylUbiZUMvghizhfY-NWw3QU8') || '',
            telegramChatId: localStorage.getItem('6631390586') || '',
            showScanner: false,
            formData: { name: '', role: '' },
            submitted: false
        };

        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('mode') === 'scan') {
            state.showScanner = true;
        }

        function setState(newState) {
            state = { ...state, ...newState };
            render();
        }

        function generateQRCodeURL() {
            const baseUrl = window.location.href.split('?')[0];
            const scanUrl = baseUrl + '?mode=scan';
            return `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(scanUrl)}`;
        }

        function downloadQR() {
            const link = document.createElement('a');
            link.href = generateQRCodeURL();
            link.download = 'Staff_CheckIn_QR.png';
            link.click();
        }

        function saveTelegramConfig() {
            localStorage.setItem('botToken', state.telegramBotToken);
            localStorage.setItem('chatId', state.telegramChatId);
        }

        async function sendToTelegram(action) {
            if (!state.formData.name || !state.formData.role) {
                alert('Please enter your name and role / áŸá¼á˜á”áŸ†á–áŸá‰áˆáŸ’á˜áŸ„áŸ‡ á“á·á„áá½á“á¶á‘á¸');
                return;
            }

            if (!state.telegramBotToken || !state.telegramChatId) {
                alert('Telegram configuration missing / á–á»áŸ†á”á¶á“á€áŸ†áááŸ‹ Telegram');
                return;
            }

            const now = new Date();
            const time = now.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit', 
                hour12: false 
            });
            const date = now.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            const actionEmoji = action === 'in' ? 'ğŸŸ¢' : 'ğŸ”´';
            const actionText = action === 'in' ? 'CHECK IN / á…á¼á›' : 'CHECK OUT / á…áŸá‰';
            
            const message = `${actionEmoji} *${actionText}*\n\n` +
                           `ğŸ‘¤ *Name:* ${state.formData.name}\n` +
                           `ğŸ’¼ *Role:* ${state.formData.role}\n` +
                           `ğŸ• *Time:* ${time}\n` +
                           `ğŸ“… *Date:* ${date}`;

            try {
                const response = await fetch(`https://api.telegram.org/bot${state.telegramBotToken}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: state.telegramChatId,
                        text: message,
                        parse_mode: 'Markdown'
                    })
                });

                if (response.ok) {
                    setState({ submitted: true });
                    setTimeout(() => {
                        setState({ 
                            submitted: false, 
                            formData: { name: '', role: '' } 
                        });
                    }, 3000);
                } else {
                    alert('Failed to send to Telegram / á”ášá¶á‡áŸá™á€áŸ’á“á»á„á€á¶ášá•áŸ’á‰á¾á‘áŸ… Telegram');
                }
            } catch (error) {
                alert('Error sending to Telegram / á˜á¶á“á”á‰áŸ’á á¶á€áŸ’á“á»á„á€á¶ášá•áŸ’á‰á¾á‘áŸ… Telegram');
            }
        }

        function renderAdminView() {
            return `
                <div class="max-w-4xl mx-auto p-6">
                    <div class="text-center mb-8">
                        <h1 class="text-4xl font-bold text-gray-800 mb-2">Staff Check-In QR System</h1>
                        <p class="text-gray-600">Configure Telegram and generate QR code</p>
                    </div>

                    <div class="bg-white rounded-lg shadow-lg p-8 mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6">Telegram Configuration</h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Telegram Bot Token</label>
                                <input
                                    type="text"
                                    value="${state.telegramBotToken}"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg"
                                    placeholder="1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"
                                    onchange="setState({ telegramBotToken: this.value }); saveTelegramConfig();"
                                />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Telegram Chat ID</label>
                                <input
                                    type="text"
                                    value="${state.telegramChatId}"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg"
                                    placeholder="-1001234567890"
                                    onchange="setState({ telegramChatId: this.value }); saveTelegramConfig();"
                                />
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-lg p-8 text-center">
                        <h2 class="text-2xl font-semibold text-gray-800 mb-6">QR Code for Staff</h2>
                        <img src="${generateQRCodeURL()}" alt="QR Code" class="mx-auto mb-6 border-4 border-indigo-600 rounded-lg"/>
                        <button onclick="downloadQR()" class="bg-green-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-green-700">Download QR Code</button>
                    </div>
                </div>
            `;
        }

        function renderScannerView() {
            if (state.submitted) {
                return `
                    <div class="min-h-screen flex items-center justify-center p-6">
                        <div class="bg-white rounded-lg shadow-2xl p-8 text-center">
                            <h2 class="text-3xl font-bold text-green-600 mb-3">Success!</h2>
                            <p class="text-gray-600">Your attendance has been recorded</p>
                            <p class="text-gray-500">á€ááŸ‹ááŸ’ášá¶áœááŸ’áá˜á¶á“ášá½á…ášá¶á›áŸ‹</p>
                        </div>
                    </div>
                `;
            }

            return `
                <div class="max-w-2xl mx-auto p-6">
                    <div class="text-center mb-8">
                        <h1 class="text-4xl font-bold text-gray-800 mb-2">Staff Check-In/Out</h1>
                        <p class="text-gray-600 text-lg">á…á¼á›-á…áŸá‰á”á»á‚áŸ’á‚á›á·á€</p>
                    </div>

                    <div class="bg-white rounded-lg shadow-lg p-8">
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Full Name / áˆáŸ’á˜áŸ„áŸ‡á–áŸá‰ *</label>
                                <input
                                    type="text"
                                    value="${state.formData.name}"
                                    class="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg"
                                    placeholder="áŸá»á áŸáŸ†áá¶á„ / John Doe"
                                    onchange="setState({ formData: { ...state.formData, name: this.value } })"
                                />
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Role / áá½á“á¶á‘á¸ *</label>
                                <input
                                    type="text"
                                    value="${state.formData.role}"
                                    class="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg"
                                    placeholder="á¢áŸ’á“á€á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„ / Manager"
                                    onchange="setState({ formData: { ...state.formData, role: this.value } })"
                                />
                            </div>

                            <div class="grid grid-cols-2 gap-4 pt-4">
                                <button onclick="sendToTelegram('in')" class="bg-green-600 text-white py-4 rounded-lg font-semibold text-lg hover:bg-green-700">
                                    CHECK IN<br/>á…á¼á›
                                </button>
                                <button onclick="sendToTelegram('out')" class="bg-red-600 text-white py-4 rounded-lg font-semibold text-lg hover:bg-red-700">
                                    CHECK OUT<br/>á…áŸá‰
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            if (state.showScanner) {
                app.innerHTML = renderScannerView();
            } else {
                app.innerHTML = renderAdminView();
            }
        }

        render();
    </script>
</body>
</html>

